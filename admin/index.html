<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVTAIR - Admin Dashboard</title>
    <script src="../assets/js/database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2C2C2C 0%, #4A4A4A 30%, #666666 70%, #A8A8A8 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 1px solid rgba(168, 168, 168, 0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #1A1A1A 0%, #333333 50%, #4A4A4A 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .company-name {
            color: #A8A8A8;
            font-size: 2.5em;
            font-weight: 300;
            margin-bottom: 8px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
            letter-spacing: 5px;
            font-family: 'Arial', sans-serif;
        }
        
        .page-title {
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 600;
            color: white;
        }
        
        .page-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            color: #CCCCCC;
        }
        
        .content {
            padding: 30px;
            background: linear-gradient(135deg, #FAFAFA, #F8FAFC);
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .admin-card:hover {
            border-color: #7c3aed;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.2);
        }
        
        .card-icon {
            font-size: 3em;
            text-align: center;
            margin-bottom: 15px;
            color: #7c3aed;
        }
        
        .card-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .card-description {
            color: #6b7280;
            text-align: center;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .card-button {
            background: linear-gradient(135deg, #7c3aed, #5b21b6);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1em;
        }
        
        .card-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }
        
        .stats-overview {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stats-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            border-color: #7c3aed;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #7c3aed;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .quick-actions {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .quick-actions-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #1A1A1A, #333333);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .action-btn.success {
            background: linear-gradient(135deg, #059669, #047857);
        }
        
        .action-btn.warning {
            background: linear-gradient(135deg, #d97706, #b45309);
        }
        
        .action-btn.info {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
        }
        
        .loading-message {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            color: #6b7280;
        }
        
        .error-message {
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            color: #991b1b;
        }
        
        .success-message {
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            color: #166534;
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
            color: #065F46;
            border: 2px solid #A7F3D0;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #FEF2F2, #FECACA);
            color: #991B1B;
            border: 2px solid #FECACA;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #DBEAFE, #BFDBFE);
            color: #1E40AF;
            border: 2px solid #BFDBFE;
        }
        
        @media (max-width: 768px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .company-name {
                font-size: 2em;
            }
            
            .container {
                margin: 5px;
                border-radius: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-name">PVTAIR</div>
            <div class="page-title">Administrative Dashboard</div>
            <div class="page-subtitle">Comprehensive system management and oversight</div>
        </div>
        
        <div class="content">
            <!-- Statistics Overview -->
            <div class="stats-overview">
                <h2 class="stats-title">System Overview</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalEmployees">0</div>
                        <div class="stat-label">Total Employees</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalSupervisors">0</div>
                        <div class="stat-label">Supervisors</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pendingTimecards">0</div>
                        <div class="stat-label">Pending Timecards</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalHoursWeek">0</div>
                        <div class="stat-label">Hours This Week</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="systemStatus">●</div>
                        <div class="stat-label">System Status</div>
                    </div>
                </div>
            </div>

            <!-- Main Admin Functions -->
            <div class="admin-grid">
                <div class="admin-card" onclick="openEmployeeManagement()">
                    <div class="card-icon">👥</div>
                    <div class="card-title">Employee Management</div>
                    <div class="card-description">
                        Add, edit, and manage employee profiles, roles, and permissions
                    </div>
                    <button class="card-button">Manage Employees</button>
                </div>

                <div class="admin-card" onclick="openTimecardReview()">
                    <div class="card-icon">📋</div>
                    <div class="card-title">Timecard Review</div>
                    <div class="card-description">
                        Review, approve, and manage all employee timecard submissions
                    </div>
                    <button class="card-button">Review Timecards</button>
                </div>

                <div class="admin-card" onclick="openReportsAnalytics()">
                    <div class="card-icon">📈</div>
                    <div class="card-title">Reports & Analytics</div>
                    <div class="card-description">
                        Generate comprehensive reports and view system analytics
                    </div>
                    <button class="card-button">View Reports</button>
                </div>

                <div class="admin-card" onclick="openSystemSettings()">
                    <div class="card-icon">⚙️</div>
                    <div class="card-title">System Settings</div>
                    <div class="card-description">
                        Configure system parameters, permissions, and integrations
                    </div>
                    <button class="card-button">System Settings</button>
                </div>

                <div class="admin-card" onclick="openDataExport()">
                    <div class="card-icon">💾</div>
                    <div class="card-title">Data Export</div>
                    <div class="card-description">
                        Export timecard data, employee records, and system reports
                    </div>
                    <button class="card-button">Export Data</button>
                </div>

                <div class="admin-card" onclick="openAuditLog()">
                    <div class="card-icon">📜</div>
                    <div class="card-title">Audit Log</div>
                    <div class="card-description">
                        View system activity, changes, and security logs
                    </div>
                    <button class="card-button">View Audit Log</button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3 class="quick-actions-title">Quick Actions</h3>
                <div class="actions-grid">
                    <button class="action-btn success" onclick="approveAllPending()">
                        Approve All Pending
                    </button>
                    <button class="action-btn warning" onclick="sendReminders()">
                        Send Timecard Reminders
                    </button>
                    <button class="action-btn info" onclick="generateWeeklyReport()">
                        Generate Weekly Report
                    </button>
                    <button class="action-btn" onclick="backupData()">
                        Backup System Data
                    </button>
                    <button class="action-btn success" onclick="syncGoogleSheets()">
                        Sync Google Sheets
                    </button>
                    <button class="action-btn warning" onclick="viewErrorLog()">
                        View Error Log
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let adminDatabase = null;
        let currentSupervisor = null;
        let systemData = {
            employees: [],
            supervisors: [],
            timecards: [],
            stats: {}
        };

        // Wait for shared database to be ready
        window.addEventListener('databaseReady', function() {
            adminDatabase = window.database;
            console.log('Admin dashboard using shared database connection');
            
            // Start authentication check once database is ready
            checkSupervisorAuthentication();
        });

        // Supervisor authentication functions
        async function checkSupervisorAuthentication() {
            // Make sure database is ready
            if (!adminDatabase) {
                console.log('Database not ready, waiting...');
                setTimeout(checkSupervisorAuthentication, 500);
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const supervisorId = urlParams.get('supervisor');
            
            if (!supervisorId) {
                showSupervisorLogin();
                return;
            }
            
            // If supervisor ID in URL, verify it's valid
            try {
                const supervisors = await adminDatabase.getSupervisors();
                const supervisor = supervisors.find(s => s.supervisor_id == supervisorId);
                
                if (supervisor) {
                    currentSupervisor = supervisor;
                    document.querySelector('.page-title').textContent = `Admin Dashboard - ${supervisor.name}`;
                    loadSystemData();
                } else {
                    showSupervisorLogin();
                }
            } catch (error) {
                console.error('Error verifying supervisor:', error);
                showSupervisorLogin();
            }
        }

        function showSupervisorLogin() {
            const content = document.querySelector('.content');
            content.innerHTML = `
                <div style="max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                    <h2 style="text-align: center; color: #1f2937; margin-bottom: 20px;">Supervisor Login</h2>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px;">Supervisor:</label>
                        <select id="supervisorSelect" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;">
                            <option value="">Loading supervisors...</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px;">PIN:</label>
                        <input type="password" id="supervisorPin" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; text-align: center;" placeholder="Enter PIN" maxlength="4">
                    </div>
                    
                    <button onclick="validateSupervisorLogin()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #7c3aed, #5b21b6); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Login</button>
                    
                    <div id="loginError" style="color: #dc2626; text-align: center; margin-top: 15px; display: none;"></div>
                </div>
            `;
            
            loadSupervisorOptions();
        }

        async function loadSupervisorOptions() {
            try {
                const supervisors = await adminDatabase.getSupervisors();
                const select = document.getElementById('supervisorSelect');
                
                select.innerHTML = '<option value="">Choose supervisor...</option>';
                supervisors.forEach(supervisor => {
                    select.innerHTML += `<option value="${supervisor.supervisor_id}">${supervisor.name} - ${supervisor.title}</option>`;
                });
            } catch (error) {
                console.error('Error loading supervisors:', error);
                document.getElementById('supervisorSelect').innerHTML = '<option value="">Error loading supervisors</option>';
            }
        }

        async function validateSupervisorLogin() {
            const supervisorId = document.getElementById('supervisorSelect').value;
            const pin = document.getElementById('supervisorPin').value;
            const errorDiv = document.getElementById('loginError');
            
            errorDiv.style.display = 'none';
            
            if (!supervisorId || !pin) {
                errorDiv.textContent = 'Please select supervisor and enter PIN';
                errorDiv.style.display = 'block';
                return;
            }
            
            try {
                const params = new URLSearchParams();
                params.append('action', 'validateSupervisorLogin');
                params.append('data', JSON.stringify({ supervisor_id: parseInt(supervisorId), pin: pin }));
                
                const response = await fetch(`${adminDatabase.scriptUrl}?${params.toString()}`);
                const result = await response.json();
                
                if (result.success) {
                    window.location.href = `?supervisor=${supervisorId}`;
                } else {
                    errorDiv.textContent = 'Invalid PIN';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'Login error - please try again';
                errorDiv.style.display = 'block';
            }
        }

        // Load all system data from Google Sheets
        async function loadSystemData() {
            showAlert('Loading system data from Google Sheets...', 'info');
            
            try {
                // Load all data in parallel
                const [employees, supervisors, timecards] = await Promise.all([
                    adminDatabase.getEmployees(),
                    adminDatabase.getSupervisors(),
                    adminDatabase.getTimecards()
                ]);

                // Store data globally
                systemData.employees = employees;
                systemData.supervisors = supervisors;
                systemData.timecards = timecards;

                // Calculate and display statistics
                calculateAndDisplayStats();
                
                showAlert('System data loaded successfully from Google Sheets', 'success');
                console.log('System data loaded:', systemData);

            } catch (error) {
                console.error('Error loading system data:', error);
                showAlert('Failed to load system data from Google Sheets. Please check your connection.', 'error');
                displayErrorStats();
            }
        }

        function calculateAndDisplayStats() {
            const { employees, supervisors, timecards } = systemData;

            // Calculate statistics
            const totalEmployees = employees.length;
            const totalSupervisors = supervisors.length;
            const pendingTimecards = timecards.filter(tc => tc.status === 'pending' || tc.status === 'submitted').length;
            
            // Calculate total hours for current week
            const weekStart = getWeekStart(new Date());
            const weeklyTimecards = timecards.filter(tc => {
                const tcDate = new Date(tc.date);
                return tcDate >= weekStart && tc.status === 'approved';
            });
            const totalHoursWeek = weeklyTimecards.reduce((sum, tc) => sum + (parseFloat(tc.total_hours) || 0), 0);

            // Update display
            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('totalSupervisors').textContent = totalSupervisors;
            document.getElementById('pendingTimecards').textContent = pendingTimecards;
            document.getElementById('totalHoursWeek').textContent = Math.round(totalHoursWeek);
            
            // System status indicator
            const statusElement = document.getElementById('systemStatus');
            if (totalEmployees > 0 && timecards.length > 0) {
                statusElement.textContent = '●';
                statusElement.style.color = '#10b981';
            } else {
                statusElement.textContent = '●';
                statusElement.style.color = '#f59e0b';
            }
        }

        function displayErrorStats() {
            document.getElementById('totalEmployees').textContent = '?';
            document.getElementById('totalSupervisors').textContent = '?';
            document.getElementById('pendingTimecards').textContent = '?';
            document.getElementById('totalHoursWeek').textContent = '?';
            document.getElementById('systemStatus').textContent = '●';
            document.getElementById('systemStatus').style.color = '#ef4444';
        }

        // Utility function to get week start date
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }

        // Admin function implementations
        function openEmployeeManagement() {
            showAlert('Opening employee management interface...', 'info');
            console.log('Employee management opened');
        }

     async function openTimecardReview() {
    if (!currentSupervisor) {
        showAlert('Authentication error - please refresh the page', 'error');
        return;
    }

    showAlert('Loading pending timecards...', 'info');
    
    try {
        // Get all submitted timecards
        const allTimecards = await adminDatabase.getTimecards();
        const employees = await adminDatabase.getEmployees();
        
        // Filter timecards for this supervisor's direct reports
        const supervisorEmployees = employees.filter(emp => emp.supervisor_id == currentSupervisor.supervisor_id);
        const employeeIds = supervisorEmployees.map(emp => emp.id);
        
        const pendingTimecards = allTimecards.filter(tc => 
            (tc.status === 'submitted' || tc.status === 'submitted_monthly') && 
            employeeIds.includes(tc.employee_id)
        );
        
        displayTimecardReview(pendingTimecards, supervisorEmployees);
        
    } catch (error) {
        console.error('Error loading timecards:', error);
        showAlert('Failed to load timecards for review', 'error');
    }
}

function displayTimecardReview(timecards, employees) {
    const content = document.querySelector('.content');
    
    if (timecards.length === 0) {
        content.innerHTML = `
            <div style="text-align: center; padding: 50px;">
                <h2>No Pending Timecards</h2>
                <p style="color: #6b7280; margin: 20px 0;">All timecards for your direct reports have been processed.</p>
                <button onclick="checkSupervisorAuthentication()" style="background: linear-gradient(135deg, #7c3aed, #5b21b6); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Back to Dashboard</button>
            </div>
        `;
        return;
    }

    let reviewHTML = `
        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h2>Timecard Review - ${timecards.length} Pending</h2>
            <button onclick="checkSupervisorAuthentication()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Back to Dashboard</button>
        </div>
    `;

    timecards.forEach(timecard => {
        const employee = employees.find(emp => emp.id === timecard.employee_id);
        const employeeName = employee ? employee.name : timecard.employee_id;
        
        reviewHTML += `
            <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 2px solid #e5e7eb;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: #1f2937;">${employeeName}</h3>
                    <span style="background: #fbbf24; color: #92400e; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">PENDING APPROVAL</span>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div><strong>Week Starting:</strong> ${timecard.week_starting || timecard.date}</div>
                    <div><strong>Total Hours:</strong> ${timecard.total_hours || 0}</div>
                    <div><strong>Total Pay:</strong> $${(timecard.total_pay || 0).toFixed(2)}</div>
                    <div><strong>Submitted:</strong> ${timecard.submitted_date}</div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="approveTimecard('${timecard.employee_id}', '${timecard.week_starting || timecard.date}')" 
                            style="background: linear-gradient(135deg, #059669, #047857); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        Approve
                    </button>
                    <button onclick="rejectTimecard('${timecard.employee_id}', '${timecard.week_starting || timecard.date}')" 
                            style="background: linear-gradient(135deg, #dc2626, #991b1b); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        Reject
                    </button>
                    <button onclick="viewTimecardDetails('${timecard.employee_id}', '${timecard.week_starting || timecard.date}')" 
                            style="background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                        View Details
                    </button>
                </div>
            </div>
        `;
    });

    content.innerHTML = reviewHTML;
}

        function openReportsAnalytics() {
            showAlert('Opening reports and analytics...', 'info');
            console.log('Reports and analytics opened');
        }

        function openSystemSettings() {
            showAlert('Opening system settings...', 'info');
            console.log('System settings opened');
        }

        function openDataExport() {
            showAlert('Preparing data export...', 'info');
            console.log('Data export opened');
        }

        function openAuditLog() {
            showAlert('Opening audit log...', 'info');
            console.log('Audit log opened');
        }

        // Quick action implementations
        async function approveAllPending() {
            const pendingCount = systemData.timecards.filter(tc => tc.status === 'pending' || tc.status === 'submitted').length;
            
            if (pendingCount === 0) {
                showAlert('No pending timecards to approve', 'info');
                return;
            }

            if (!confirm(`Are you sure you want to approve all ${pendingCount} pending timecards?`)) {
                return;
            }

            try {
                showAlert('Approving all pending timecards...', 'info');
                await adminDatabase.approveAllPendingTimecards(currentSupervisor.supervisor_id);
                showAlert(`Successfully approved ${pendingCount} timecards`, 'success');
                
                // Reload data to reflect changes
                await loadSystemData();
                
            } catch (error) {
                console.error('Error approving timecards:', error);
                showAlert('Failed to approve timecards. Please try again.', 'error');
            }
        }

        function sendReminders() {
            showAlert('Sending timecard reminders to employees...', 'info');
            setTimeout(() => {
                showAlert('Reminders sent successfully', 'success');
            }, 2000);
        }

        function generateWeeklyReport() {
            showAlert('Generating weekly timecard report...', 'info');
            setTimeout(() => {
                showAlert('Weekly report generated and ready for download', 'success');
            }, 3000);
        }

        function backupData() {
            showAlert('Creating system data backup...', 'info');
            setTimeout(() => {
                showAlert('System backup completed successfully', 'success');
            }, 4000);
        }

        async function syncGoogleSheets() {
            showAlert('Synchronizing with Google Sheets...', 'info');
            try {
                await loadSystemData();
                showAlert('Google Sheets synchronization completed', 'success');
            } catch (error) {
                showAlert('Synchronization failed. Please check your connection.', 'error');
            }
        }

        function viewErrorLog() {
            showAlert('Opening system error log...', 'info');
            console.log('Error log opened');
        }

        // Utility functions
        function showAlert(message, type = 'info') {
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());
            
            // Create new alert
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            // Insert at the top of content
            const content = document.querySelector('.content');
            content.insertBefore(alert, content.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin dashboard loaded, waiting for database...');
        });

        // Refresh data every 5 minutes (only if logged in)
        setInterval(() => {
            if (currentSupervisor && adminDatabase) {
                loadSystemData();
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
